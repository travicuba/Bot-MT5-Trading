<Page x:Class="TradingBotDesktop.Views.MT5BotView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="#FF0A0E27" Title="MT5 Bot">

    <Page.Resources>
        <ResourceDictionary Source="../Resources/Styles.xaml"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="90"/>   <!-- Header del bot -->
            <RowDefinition Height="*"/>    <!-- Tabs -->
        </Grid.RowDefinitions>

        <!-- â•â• BOT HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="0" Background="#FF151B3D">
            <Border.BorderBrush>
                <LinearGradientBrush StartPoint="0,1" EndPoint="1,1">
                    <GradientStop Color="#FF4895EF" Offset="0"/>
                    <GradientStop Color="#FF0A0E27" Offset="1"/>
                </LinearGradientBrush>
            </Border.BorderBrush>
            <Border.BorderThickness>0,0,0,2</Border.BorderThickness>
            <Grid Margin="20,0">
                <!-- Izquierda: estado conexiÃ³n -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse x:Name="ConnDot" Width="18" Height="18" Fill="#FFFF006E"
                             VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <StackPanel>
                        <TextBlock x:Name="ConnStatus" Text="DESCONECTADO" FontSize="14" FontWeight="Bold"
                                   Foreground="#FFFF006E" FontFamily="Consolas"/>
                        <TextBlock x:Name="ConnInfo" Text="MT5 Expert Advisor" FontSize="10"
                                   Foreground="#FF8B9DC3" FontFamily="Consolas"/>
                    </StackPanel>

                    <Rectangle Width="1" Fill="#FF2A3060" Margin="20,8,20,8"/>

                    <!-- Estado del bot -->
                    <Ellipse x:Name="BotDot" Width="18" Height="18" Fill="#FFFF006E"
                             VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <StackPanel>
                        <TextBlock x:Name="BotStatus" Text="DETENIDO" FontSize="14" FontWeight="Bold"
                                   Foreground="#FFFF006E" FontFamily="Consolas"/>
                        <TextBlock x:Name="BotInfo" Text="Bot inactivo" FontSize="10"
                                   Foreground="#FF8B9DC3" FontFamily="Consolas"/>
                    </StackPanel>

                    <Rectangle Width="1" Fill="#FF2A3060" Margin="20,8,20,8"/>

                    <!-- Stats rÃ¡pidas -->
                    <StackPanel>
                        <TextBlock x:Name="TodayPnl" Text="PnL hoy: â€”" FontSize="11"
                                   Foreground="#FF8B9DC3" FontFamily="Consolas"/>
                        <TextBlock x:Name="TodayTrades" Text="Trades: â€”" FontSize="11"
                                   Foreground="#FF8B9DC3" FontFamily="Consolas"/>
                    </StackPanel>
                </StackPanel>

                <!-- Derecha: controles -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button x:Name="StartBtn" Content="â–¶  INICIAR" Style="{StaticResource GreenButton}"
                            Height="36" Padding="16,0" Margin="0,0,8,0" Click="StartBot_Click"/>
                    <Button x:Name="StopBtn" Content="â–   DETENER" Style="{StaticResource RedButton}"
                            Height="36" Padding="16,0" IsEnabled="False" Click="StopBot_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <TabControl Grid.Row="1" Style="{StaticResource DarkTabControl}">

            <!-- â”€â”€ Dashboard â”€â”€ -->
            <TabItem Header="  Dashboard  " Style="{StaticResource DarkTabItem}">
                <Grid Margin="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Izq: stats de hoy + seÃ±al IA -->
                    <StackPanel Grid.Column="0">
                        <!-- MÃ©tricas de hoy -->
                        <Border Style="{StaticResource CardPanel}" Margin="0,0,0,8">
                            <StackPanel>
                                <TextBlock Text="HOY" Style="{StaticResource SectionTitle}"/>
                                <UniformGrid Columns="3" Margin="0,4,0,0">
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock x:Name="StatTrades" Text="0" Style="{StaticResource StatValue}"
                                                   Foreground="#FF4895EF"/>
                                        <TextBlock Text="Trades" Style="{StaticResource StatLabel}"/>
                                    </StackPanel>
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock x:Name="StatWins" Text="0" Style="{StaticResource StatValue}"
                                                   Foreground="#FF06FFA5"/>
                                        <TextBlock Text="Ganados" Style="{StaticResource StatLabel}"/>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock x:Name="StatWinRate" Text="0%" Style="{StaticResource StatValue}"
                                                   Foreground="#FFFFBE0B"/>
                                        <TextBlock Text="Win Rate" Style="{StaticResource StatLabel}"/>
                                    </StackPanel>
                                </UniformGrid>
                                <UniformGrid Columns="2" Margin="0,12,0,0">
                                    <StackPanel Margin="0,0,8,0">
                                        <TextBlock x:Name="StatPips" Text="0" Style="{StaticResource StatValue}"/>
                                        <TextBlock Text="Pips totales" Style="{StaticResource StatLabel}"/>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock x:Name="StatTotal" Text="0" Style="{StaticResource StatValue}"
                                                   Foreground="#FF8B9DC3"/>
                                        <TextBlock Text="Total histÃ³rico" Style="{StaticResource StatLabel}"/>
                                    </StackPanel>
                                </UniformGrid>
                            </StackPanel>
                        </Border>

                        <!-- Panel IA de anÃ¡lisis -->
                        <Border Background="#FF151B3D" BorderBrush="#FF2A3060" BorderThickness="1"
                                CornerRadius="10" Padding="14">
                            <StackPanel>
                                <TextBlock Text="ðŸ¤– ANÃLISIS IA" FontSize="11" FontWeight="Bold"
                                           Foreground="#FFFF9A00" FontFamily="Consolas" Margin="0,0,0,10"/>
                                <TextBox x:Name="AiPanel" IsReadOnly="True" FontSize="11"
                                         Background="#FF0A0E27" Foreground="#FFE0E6FF"
                                         FontFamily="Consolas" BorderThickness="0"
                                         TextWrapping="Wrap" MinHeight="120" Padding="4"
                                         Text="Esperando datos del bot..."/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Der: bridge status + logs -->
                    <StackPanel Grid.Column="2">
                        <Border Style="{StaticResource CardPanel}" Margin="0,0,0,8">
                            <StackPanel>
                                <TextBlock Text="PUENTE MT5" Style="{StaticResource SectionTitle}"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <Ellipse x:Name="BridgeDot" Width="10" Height="10"
                                             Fill="#FF555555" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock x:Name="BridgeStatus" Text="Inactivo"
                                               Foreground="#FF8B9DC3" FontFamily="Consolas" FontSize="11"/>
                                </StackPanel>
                                <TextBlock x:Name="BridgePath" Text="Sin configurar"
                                           Foreground="#FF4A5280" FontFamily="Consolas" FontSize="10"
                                           TextWrapping="Wrap" Margin="0,4,0,0"/>
                                <Button Content="Configurar ruta MT5" Style="{StaticResource SecondaryButton}"
                                        Height="32" FontSize="11" Margin="0,10,0,0"
                                        Click="ConfigureBridge_Click"/>
                            </StackPanel>
                        </Border>

                        <Border Style="{StaticResource CardPanel}" MinHeight="200">
                            <StackPanel>
                                <TextBlock Text="SEÃ‘AL ACTUAL" Style="{StaticResource SectionTitle}"/>
                                <TextBlock x:Name="CurrentSignal" Text="â€”" FontSize="28" FontWeight="Bold"
                                           Foreground="#FF4895EF" FontFamily="Consolas"/>
                                <TextBlock x:Name="SignalDetail" Text="Sin seÃ±al activa"
                                           Foreground="#FF8B9DC3" FontFamily="Consolas" FontSize="11"
                                           TextWrapping="Wrap" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- â”€â”€ EstadÃ­sticas â”€â”€ -->
            <TabItem Header="  EstadÃ­sticas  " Style="{StaticResource DarkTabItem}">
                <Grid Margin="12">
                    <Border Style="{StaticResource CardPanel}">
                        <StackPanel>
                            <TextBlock Text="RENDIMIENTO HISTÃ“RICO" Style="{StaticResource SectionTitle}"/>
                            <DataGrid x:Name="StatsGrid" AutoGenerateColumns="False"
                                      Height="300" Margin="0,8,0,0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Setup" Binding="{Binding Setup}" Width="*"/>
                                    <DataGridTextColumn Header="Trades" Binding="{Binding Trades}" Width="80"/>
                                    <DataGridTextColumn Header="Wins" Binding="{Binding Wins}" Width="80"/>
                                    <DataGridTextColumn Header="Losses" Binding="{Binding Losses}" Width="80"/>
                                    <DataGridTextColumn Header="Win%" Binding="{Binding WinRate}" Width="80"/>
                                    <DataGridTextColumn Header="Pips" Binding="{Binding Pips}" Width="80"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Content="â†» Actualizar" Style="{StaticResource SecondaryButton}"
                                    Height="34" FontSize="11" Margin="0,12,0,0"
                                    HorizontalAlignment="Left" Click="RefreshStats_Click"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

            <!-- â”€â”€ Historial â”€â”€ -->
            <TabItem Header="  Historial  " Style="{StaticResource DarkTabItem}">
                <Grid Margin="12">
                    <Border Style="{StaticResource CardPanel}">
                        <StackPanel>
                            <TextBlock Text="HISTORIAL DE OPERACIONES" Style="{StaticResource SectionTitle}"/>
                            <DataGrid x:Name="HistoryGrid" AutoGenerateColumns="False"
                                      Height="380" Margin="0,8,0,0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Fecha" Binding="{Binding Date}" Width="120"/>
                                    <DataGridTextColumn Header="SÃ­mbolo" Binding="{Binding Symbol}" Width="90"/>
                                    <DataGridTextColumn Header="AcciÃ³n" Binding="{Binding Action}" Width="70"/>
                                    <DataGridTextColumn Header="Resultado" Binding="{Binding Result}" Width="80"/>
                                    <DataGridTextColumn Header="Pips" Binding="{Binding Pips}" Width="70"/>
                                    <DataGridTextColumn Header="Setup" Binding="{Binding Setup}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

            <!-- â”€â”€ ConfiguraciÃ³n â”€â”€ -->
            <TabItem Header="  ConfiguraciÃ³n  " Style="{StaticResource DarkTabItem}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/><ColumnDefinition Width="12"/><ColumnDefinition/>
                        </Grid.ColumnDefinitions>

                        <!-- Izq: parÃ¡metros del bot -->
                        <Border Grid.Column="0" Style="{StaticResource CardPanel}">
                            <StackPanel>
                                <TextBlock Text="PARÃMETROS DEL BOT" Style="{StaticResource SectionTitle}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/><ColumnDefinition Width="8"/><ColumnDefinition/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="8"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="8"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="8"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="8"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Label Grid.Row="0" Grid.Column="0" Content="Confianza mÃ­nima (%):" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CfgMinConf" Grid.Row="0" Grid.Column="2" Text="5" Height="34"/>

                                    <Label Grid.Row="2" Grid.Column="0" Content="Cooldown (seg):" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CfgCooldown" Grid.Row="2" Grid.Column="2" Text="30" Height="34"/>

                                    <Label Grid.Row="4" Grid.Column="0" Content="MÃ¡x. trades diarios:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CfgMaxTrades" Grid.Row="4" Grid.Column="2" Text="50" Height="34"/>

                                    <Label Grid.Row="6" Grid.Column="0" Content="TamaÃ±o de lote:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CfgLotSize" Grid.Row="6" Grid.Column="2" Text="0.01" Height="34"/>

                                    <Label Grid.Row="8" Grid.Column="0" Content="MÃ¡x. pÃ©rdidas consec.:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="CfgMaxLoss" Grid.Row="8" Grid.Column="2" Text="5" Height="34"/>
                                </Grid>

                                <Button Content="ðŸ’¾ Guardar en servidor" Style="{StaticResource PrimaryButton}"
                                        Height="38" FontSize="12" Margin="0,20,0,0"
                                        Click="SaveConfig_Click"/>
                                <TextBlock x:Name="ConfigStatus" Text="" Foreground="#FF06FFA5"
                                           FontFamily="Consolas" FontSize="11" Margin="0,8,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Der: credenciales MT5 -->
                        <Border Grid.Column="2" Style="{StaticResource CardPanel}">
                            <StackPanel>
                                <TextBlock Text="CREDENCIALES MT5" Style="{StaticResource SectionTitle}"/>
                                <Label Content="NÃºmero de cuenta:"/>
                                <TextBox x:Name="Mt5Account" Height="34" Margin="0,0,0,10"/>
                                <Label Content="ContraseÃ±a:"/>
                                <PasswordBox x:Name="Mt5Password" Height="34" Margin="0,0,0,10"/>
                                <Label Content="Servidor:"/>
                                <TextBox x:Name="Mt5Server" Height="34" Margin="0,0,0,20"/>
                                <Button Content="ðŸ’¾ Guardar credenciales" Style="{StaticResource SecondaryButton}"
                                        Height="38" FontSize="12" Click="SaveMt5Creds_Click"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- â”€â”€ Sistema â”€â”€ -->
            <TabItem Header="  Sistema  " Style="{StaticResource DarkTabItem}">
                <ScrollViewer Margin="12" VerticalScrollBarVisibility="Auto">
                    <Border Style="{StaticResource CardPanel}">
                        <StackPanel>
                            <TextBlock Text="INFORMACIÃ“N DEL SISTEMA" Style="{StaticResource SectionTitle}"/>
                            <DataGrid x:Name="SysGrid" AutoGenerateColumns="False" Height="300" Margin="0,8,0,0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="ParÃ¡metro" Binding="{Binding Key}" Width="200"/>
                                    <DataGridTextColumn Header="Valor" Binding="{Binding Value}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Content="â†» Actualizar" Style="{StaticResource SecondaryButton}"
                                    Height="34" FontSize="11" Margin="0,12,0,0"
                                    HorizontalAlignment="Left" Click="RefreshSys_Click"/>
                        </StackPanel>
                    </Border>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Page>
