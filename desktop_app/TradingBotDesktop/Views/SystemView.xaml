<Page x:Class="TradingBotDesktop.Views.SystemView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="{StaticResource SecondaryBgBrush}"
      Title="Sistema">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Titulo -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Sistema" Style="{StaticResource PageTitle}" Margin="0"/>
            <Button Content="Actualizar" Style="{StaticResource SecondaryButton}"
                    VerticalAlignment="Center" Click="BtnRefresh_Click"/>
        </Grid>

        <!-- INFO CONEXION + PUENTE -->
        <Grid Grid.Row="1" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Conexion VPS -->
            <Border Grid.Column="0" Style="{StaticResource CardPanel}" Margin="0,0,8,0">
                <StackPanel>
                    <TextBlock Text="CONEXION VPS" Style="{StaticResource SectionTitle}"/>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Ellipse x:Name="VpsStatusDot" Width="10" Height="10"
                                 Fill="{StaticResource ErrorBrush}" VerticalAlignment="Center"
                                 Margin="0,0,8,0"/>
                        <TextBlock x:Name="VpsStatusText" Text="Verificando..."
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="URL:"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="VpsUrlText"
                                   Text="-" TextWrapping="Wrap"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Latencia:"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="LatencyText"
                                   Text="-" Margin="0,4,0,0"/>
                    </Grid>

                    <Button Content="Verificar Conexion" Style="{StaticResource SecondaryButton}"
                            Margin="0,12,0,0" Click="BtnPing_Click"/>
                </StackPanel>
            </Border>

            <!-- Puente MT5 -->
            <Border Grid.Column="1" Style="{StaticResource CardPanel}" Margin="8,0,0,0">
                <StackPanel>
                    <TextBlock Text="PUENTE MT5" Style="{StaticResource SectionTitle}"/>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Ellipse x:Name="BridgeStatusDot" Width="10" Height="10"
                                 Fill="{StaticResource ErrorBrush}" VerticalAlignment="Center"
                                 Margin="0,0,8,0"/>
                        <TextBlock x:Name="BridgeStatusLabel" Text="Detenido"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Ruta MT5 local:"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="Mt5PathText"
                                   Text="-" TextWrapping="Wrap" FontSize="11"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Sincronizaciones:"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="SyncCountLabel"
                                   Text="0" Margin="0,4,0,0"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Ultimo sync:"
                                   Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" x:Name="LastSyncLabel"
                                   Text="-" Margin="0,4,0,0"/>
                    </Grid>

                    <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                        <Button x:Name="BtnBridgeToggle" Content="Iniciar Puente"
                                Style="{StaticResource SuccessButton}"
                                Click="BtnBridgeToggle_Click" Margin="0,0,8,0"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- LOGS DE DEBUG -->
        <Border Grid.Row="2" Style="{StaticResource CardPanel}" Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal"
                            Margin="16,12" Background="{StaticResource PanelBgBrush}">
                    <TextBlock Text="LOG DE DEBUG" Style="{StaticResource SectionTitle}"
                               Margin="0" VerticalAlignment="Center"/>
                    <Button Content="Actualizar logs" Style="{StaticResource SecondaryButton}"
                            Margin="16,0,0,0" Click="BtnRefreshLogs_Click"/>
                </StackPanel>

                <ListBox Grid.Row="1" x:Name="LogList"
                         Background="{StaticResource PrimaryBgBrush}"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto"
                         VirtualizingStackPanel.IsVirtualizing="True"/>
            </Grid>
        </Border>
    </Grid>
</Page>
